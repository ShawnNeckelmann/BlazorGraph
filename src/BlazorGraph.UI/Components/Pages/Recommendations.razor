@page "/recommendations"
@rendermode InteractiveServer
@using BlazorGraph.Persistence.Repositories
@inject UserRepository UserRepository

<PageTitle>Recommendations</PageTitle>

<h1>Product Recommendations</h1>

<div class="mb-3">
    <label for="userSelect" class="form-label">Select a User to see what they might like:</label>
    <select id="userSelect" class="form-select" @onchange="OnUserSelected">
        <option value="">-- Choose a User --</option>
        @foreach (var name in _userNames)
        {
            <option value="@name">@name</option>
        }
    </select>
</div>

@if (_isLoading)
{
    <p>
        <em>Searching the graph... 🕸️</em>
    </p>
}
else if (_recommendations.Any())
{
    <h4>Suggested for @_selectedUserName:</h4>
    <ul class="list-group">
        @foreach (var product in _recommendations)
        {
            <li class="list-group-item">@product</li>
        }
    </ul>
}
else
{
    <p class="text-muted">No recommendations available for @_selectedUserName at this time.</p>
}


@code {
    private IList<string> _userNames = [];
    private string _selectedUserName = string.Empty;
    private IList<string> _recommendations = [];
    private bool _isLoading;


    protected override async Task OnInitializedAsync()
    {
        _isLoading = true;
        _userNames = await UserRepository.GetExistingUserNamesAsync();
        _isLoading = false;
    }

    private async Task OnUserSelected(ChangeEventArgs arg)
    {
        
        _selectedUserName = arg.Value?.ToString() ?? string.Empty;
        _recommendations = [];

        if (!string.IsNullOrWhiteSpace(_selectedUserName))
        {
            _isLoading = true;
            _recommendations = await UserRepository.GetRecommendationsAsync(_selectedUserName);
            _isLoading = false;
        }
    }

}